# Commande pour lancer le self-play et l'écriture
#./katago selfplay -config training_params.cfg -models-dir models -output-dir data -max-games-total 10

#########################
# 1. Entraînement Self-Play & Data Writing
#########################

# Global
numGameThreads = 12          # 8c/16t i7-6900K → 10 threads self-play
numSearchThreads = 4
numConcurrentSelfplay = 6

# Search limits
maxVisits = 600              # visites élevées pour évaluation précise
maxPlayouts = 400

# Game settings
boardXSize = 9
boardYSize = 9
komi = 6.5
allowResignation = true      # parties complètes pour value net
maxMovesPerGame = 500       # évite les parties interminables

# Data writing
dataBoardLen = 9
maxDataQueueSize = 2000
maxRowsPerTrainFile = 10000
firstFileRandMinProp = 0.15
writeSgf = true
writeSgfs = true
sgfDir = ./sgf_out
sgfOutputDir = ./sgf_out
sgfGamePrefix = value_training_9x9
logDir = ./log_out
logToStdout = true
logMoves = false
logGamesEvery = 1
logSearchInfo = false

#########################
# 2. Diversité et Robustesse
#########################

# Policy-guided opening & forks
sidePositionProb = 0.02
cheapSearchProb = 0.75
cheapSearchVisits = 150
cheapSearchTargetWeight = 0.00
initGamesWithPolicy = true
policyInitAreaProp = 0.08            # ouverture plus variée
compensateAfterPolicyInitProb = 0.20
startPosesProbability = 0.10         # 10 % de parties depuis SGF externes
# startPosesFromSgfDir = ./sgf_external  # si tu veux charger des SGF spécifiques
# hintPosesProb = 0.00                 # pas de hint positions par défaut

# Réduction de visites quand gagnant
reduceVisits = true
reduceVisitsThreshold = 0.90
reduceVisitsThresholdLookback = 3
reducedVisitsMin = 200
reducedVisitsWeight = 0.10

# Forks
earlyForkGameProb = 0.08             # plus de diversité en ouverture
earlyForkGameExpectedMoveProp = 0.025
forkGameProb = 0.03
forkGameMinChoices = 3
earlyForkGameMaxChoices = 12
forkGameMaxChoices = 36
sekiForkHackProb = 0.02

# Handicap / asynchronisme
handicapProb = 0.20
handicapCompensateKomiProb = 0.50
handicapAsymmetricPlayoutProb = 0.50
normalAsymmetricPlayoutProb = 0.01
maxAsymmetricRatio = 8.0
minAsymmetricCompensateKomiProb = 0.40

# Surprise data weighting
policySurpriseDataWeight = 0.50
valueSurpriseDataWeight = 0.30

# Lead estimation
estimateLeadProb = 0.20               # entraînement sur lead pour value net

#########################
# 3. Komi & Rules Variations
#########################

koRules = SIMPLE,POSITIONAL,SITUATIONAL
scoringRules = AREA,TERRITORY
komiAuto = False
komiStdev = 2.0
komiBigStdevProb = 0.06
komiBigStdev = 12.0
forkCompensateKomiProb = 0.80
sgfCompensateKomiProb = 0.90
drawRandRadius = 0.50
noResultStdev = 0.166666666

# Rules supplémentaires
taxRules = NONE
multiStoneSuicideLegals = false
hasButtons = false
bSizes = 9
bSizeRelProbs = 1.0
allowRectangleProb = 0.0

#########################
# 4. Réseau & OpenCL / GPU
#########################

modelFile = ./models/kata1-b28c512nbt-s8925522176-d4787295149.bin.gz

useNNCache = true
nnMaxBatchSize = 512
nnCacheSizePowerOfTwo = 21
nnMutexPoolSizePowerOfTwo = 17
numNNServerThreadsPerModel = 6

openclUseFP16 = auto
openclReTunePerBoardSize = true
# threads → GPUs mapping
openclDeviceToUseThread0 = 0
openclDeviceToUseThread1 = 0
openclDeviceToUseThread2 = 0
openclDeviceToUseThread3 = 1
openclDeviceToUseThread4 = 1
openclDeviceToUseThread5 = 1
nnRandomize = true

#########################
# 5. Sélection MCTS & Biases
#########################

rootNoiseEnabled = true
rootDirichletNoiseTotalConcentration = 10.83
rootDirichletNoiseWeight = 0.25

# MCTS – symétries et visites souhaitées
rootDesiredPerChildVisitsCoeff = 2.0
rootNumSymmetriesToSample = 4

chosenMoveTemperatureEarly = 0.75
chosenMoveTemperatureHalflife = 19
chosenMoveTemperature = 0.15
chosenMoveSubtract = 0
chosenMovePrune = 1

cpuctExploration = 1.1
cpuctExplorationLog = 0.0
fpuReductionMax = 0.2
rootFpuReductionMax = 0.0
numVirtualLossesPerThread = 1

useLcbForSelection = true
lcbStdevs = 5.0
minVisitPropForLCB = 0.15

valueWeightExponent = 0.5
subtreeValueBiasFactor = 0.30
subtreeValueBiasWeightExponent = 0.8
useNonBuggyLcb = true
useGraphSearch = true
fpuParentWeightByVisitedPolicy = true
fpuParentWeightByVisitedPolicyPow = 2.0

#########################
# 6. Autres paramètres
#########################

switchNetsMidGame = true
